[supervisord]
nodaemon=true
childlogdir=/var/log/supervisor

[supervisorctl]

# Sleep statements are necessary because Xvfb
# is starting too quickly and crashing.
[program:xvfb]
command=bash -c "sleep 10 && DISPLAY_NUMBER=$(echo ${DISPLAY} | cut --delimiter ':' --fields 2) && rm --force /tmp/.X${DISPLAY_NUMBER}-lock && /usr/bin/Xvfb ${DISPLAY} -screen 0 ${XVFB_RESOLUTION} -dpi 96"
startsecs=15
autorestart=true
priority=100

[program:pulseaudio]
command=pulseaudio --start
autorestart=false
startsecs=0
priority=100

[program:tx_player_turns]
command=bash /usr/local/bin/tx_player_turns.bash
startsecs=5
autorestart=true
priority=100

[program:crond]
command=bash -c "printenv > /root/civ5.env && crond -f"
startsecs=5
autorestart=true
priority=100

# Start a VNC server so we can remote in
# By default the DISPLAY variable is used
# to specify the display x0vncserver will
# run on.
[program:vncserver]
command=bash -c "sleep 20 && x0vncserver -rfbport ${VNC_PORT} -SecurityTypes=None -AlwaysShared=on -AcceptCutText"
startsecs=25
autorestart=true
priority=200

# Openbox is our minimal desktop environment
[program:openbox]
command=bash -c "sleep 20 && openbox"
startsecs=25
autorestart=true
priority=200

# The DXVK_FILTER_DEVICE_NAME env variable
# forces llvmpipe (software rendering).
# The DXVK_FRAME_RATE env variable restricts
# the framerate at which civ5 runs.
# By default the DISPLAY variable is used
# to specify the display civ5 will run on.
# The dlls specified in the STEAM_DLLS string
# are copied into the root civ5game folder.
# They must be present to host a game and are
# a substitute for Steam running in the
# background.
[program:civ5server]
directory=/root/civ5game
command=bash -c '/usr/local/bin/run_civ.bash'
startsecs=35
autorestart=false
priority=600
